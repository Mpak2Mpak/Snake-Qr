<!doctype html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><style>html,body{height:100%;margin:0;font-family:monospace}body{background:#222;color:#eee}#wrap{height:100%;display:flex;flex-direction:column;gap:6px;padding:10px}#g{background:#000;margin:auto;display:block;max-width:100vw;max-height:70vh;touch-action:none;border:3px solid #eee}#controls button,#pad button{appearance:none;border:2px solid #eee;background:#111;color:#eee;border-radius:0;font-family:monospace;font-weight:700}#controls button{font-size:14px;padding:10px 14px}#pad{display:grid;grid-template-columns:72px 72px 72px;grid-template-rows:60px 60px 60px;gap:10px;justify-content:center;padding:8px 0 14px}#pad button{font-size:22px}#pad .sp{visibility:hidden}</style><body><div id=wrap><canvas id=g width=640 height=480></canvas><div id=controls style="display:flex;justify-content:center;padding:10px 0 6px"><button id=resetBtn>Reset</button></div><div id=pad><button class=sp>·</button><button data-dir=38>▲</button><button class=sp>·</button><button data-dir=37>◀</button><button data-dir=40>▼</button><button data-dir=39>▶</button><button class=sp>·</button><button class=sp>·</button><button class=sp>·</button></div></div><script>const W=640,H=480,T=32,AW=W/T,AH=H/T,P=T/4,FP=T/8,M=AW*AH,U=38,D=40,L=37,R=39;var c=g,x=c.getContext("2d"),t=null,d=0,s=!1,p=[{x:Math.round(AW/2),y:Math.round(AH/2)}],f=null,q=[],v=!1;function E(a,b){return a.x==b.x&&a.y==b.y}function F(){var a;do{f={x:Math.random()*AW|0,y:Math.random()*AH|0},a=!1;for(var b of p)if(E(b,f)){a=!0;break}}while(a)}function D0(){x.clearRect(0,0,W,H);x.fillStyle="#fff";if(p.length>1)for(let i=1;i<p.length;i++){let a=p[i],b=p[i-1],m=Math.min(a.x,b.x),M=Math.max(a.x,b.x),n=Math.min(a.y,b.y),N=Math.max(a.y,b.y),r=m*T+P,y=n*T+P,w=(1+M-m)*T-2*P,h=(1+N-n)*T-2*P;m==0&&M==AW-1?(x.fillRect(0,y,T-P,h),x.fillRect(W-T+P,y,T-P,h)):n==0&&N==AH-1?(x.fillRect(r,0,w,T-P),x.fillRect(r,H-T+P,w,T-P)):x.fillRect(r,y,w,h)}else{let a=p[0];x.fillRect(a.x*T+P,a.y*T+P,T-2*P,T-2*P)}f&&(x.fillStyle="lime",x.fillRect(f.x*T+FP,f.y*T+FP,T-2*FP,T-2*FP))}function L0(){D0();requestAnimationFrame(L0)}function G(a){clearInterval(t);setTimeout(()=>alert(a),250)}function P0(){let a={...p[p.length-1]};for(;q.length;){let b=q.shift();if(!O(d,b)){d=b;break}}switch(d){case U:a.y--;break;case D:a.y++;break;case L:a.x--;break;case R:a.x++}a.x<0&&(a.x=AW-1);a.x>=AW&&(a.x=0);a.y<0&&(a.y=AH-1);a.y>=AH&&(a.y=0);let c=!1,e=E(a,f);if(!e)for(let i=1;i<p.length;i++)if(E(p[i],a)){c=!0;break}c&&(v?G("Game over!"):v=!0);if(!c){e||p.shift();p.push(a);e&&(p.length==M?(f=null,G("YOU WIN!")):F());v=!1}}function S0(){t=setInterval(P0,150);requestAnimationFrame(L0)}function O(a,b){return a==D&&b==U||a==U&&b==D||a==L&&b==R||a==R&&b==L}addEventListener("keydown",e=>{[U,L,R,D].includes(e.keyCode)&&q.push(e.keyCode);!s&&q.length&&(s=!0,S0())});F();D0();(()=>{function P1(k){q.push(k);!s&&q.length&&(s=!0,S0())}document.querySelectorAll("#pad [data-dir]").forEach(b=>b.addEventListener("pointerdown",e=>(e.preventDefault(),P1(+b.dataset.dir)),{passive:!1}));let sx=0,sy=0,a=!1;function T0(){let m=Math.min(innerWidth,innerHeight);return Math.max(18,Math.min(40,.04*m))}c.addEventListener("touchstart",e=>{if(e.touches.length==1){let t=e.touches[0];sx=t.clientX;sy=t.clientY;a=!0}},{passive:!0});c.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1});c.addEventListener("touchend",e=>{if(!a)return;a=!1;let t=e.changedTouches[0],dx=t.clientX-sx,dy=t.clientY-sy,ax=Math.abs(dx),ay=Math.abs(dy),th=T0();if(ax<th&&ay<th)return;ax>ay?P1(dx>0?R:L):P1(dy>0?D:U)},{passive:!0});function R0(){clearInterval(t);t=null;d=0;s=!1;p=[{x:Math.round(AW/2),y:Math.round(AH/2)}];f=null;q=[];v=!1;F();D0()}resetBtn.onclick=R0})();</script>
